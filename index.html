<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Testapp</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
  </head>
  <body>
	<script src="oauth.js"></script>
	
    <div class="container" style="margin-top: 100px">
      <div class="row">
        <div class="col-md-4">
        </div>
        <div class="col-md-4">
          <div class="panel panel-default">
		    <div class="panel-body">
              <button id="login" class="btn btn-default">login</button>
              <div class="loggedin-cont" style="display:none">
                
                <div>
                  <button id="logout" class="btn btn-default">logout</button>
                  <div class="user-cont">
                  </div>
                </div>
                <input type="text" id="descriptive" name="descriptive" placeholder="search keyword">
                <button id="search" class="btn btn-default">search</button>
                <br/><br/>
                <div id="resource-cont">
                </div>
              </div>
			</div>
          </div>
        </div>
        <div class="col-md-4">
        </div>
      </div>
    </div>
	<script>
	  $('#login').click(function(){
		window.OpenEd.api.init({
		  client_id: '66d0354299f860b4e39c56979f5cfd7d5216f67ce958c19ad5a3a68e6b0a2399',
		  redirect_uri: 'http://oauth2.openedtest.com:4200/callback.html'
	    });
	    window.OpenEd.api.login(function () {
		  window.OpenEd.api.request('/current_user.json', null, function (data) {
            console.log(data);
            $('.user-cont').html('email:' + data.current_user.email);
			$('#login').hide();
            $('.loggedin-cont').show();
		  });
		});
	  });
      $('#logout').click(function(){
        window.OpenEd.api.logout(function () {
		  $('#login').show();
          $('.loggedin-cont').hide();
		});
      });
      $('#search').click(function(){
        window.OpenEd.api.request('/resources.json', {descriptive: $('#descriptive').val()}, function (data) {
          var template = '';
          $('#resource-cont').html('');
          $.each(data.resources, function () {
            template += '<div class="panel panel-default">';
            template += '<div class="panel-heading">';
            template += this.title;
            template += '</div>';  
            template += '<div class="panel-body">';
            template += '<img scr="' + this.thumb + '">';
            template += '</div>';  
            template += '</div>'; 
          });
          $(template).appendTo('#resource-cont');
        });
      });
    </script>
  </body>
</html>
